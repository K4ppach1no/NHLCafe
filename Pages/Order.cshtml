@page
@using NHLCafe.Pages.Models
@model NHLCafe.Pages.OrderModel
@Html.AntiForgeryToken()
@{
}

<ul class="nav nav-tabs nav-fill" id="myTab" role="tablist">
  <li class="navbar-brand">NHL Café</li>
  <li class="nav-item " role="presentation">
    <button class="nav-link active" id="Order-tab" data-bs-toggle="tab" data-bs-target="#order" type="button" role="tab" aria-controls="order" aria-selected="true">Bestellen</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="Overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="false">Overzicht</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="PayAll-tab" data-bs-toggle="tab" data-bs-target="#payAll" type="button" role="tab" aria-controls="payAll" aria-selected="false">Alles betalen</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="PaySolo-tab" data-bs-toggle="tab" data-bs-target="#paySolo" type="button" role="tab" aria-controls="paySolo" aria-selected="false">Per persoon betalen</button>
  </li>
</ul>

<div class="tab-content" id="myTabContent">
  
@* Bestellen *@
<div class="tab-pane fade show active" id="order" role="tabpanel" aria-labelledby="Order-tab">
    
    <h2>Bestellen</h2>
    <div class="container">
      <div class="row">
        <div class="col-sm-3">
          <div class="list-group" id="list-tab" role="tablist">
            @foreach (Category category in Model.Categories)
            {
              <button class="list-group-item list-group-item-action" id="@category.Name.Replace(" ", "-")-tab" data-bs-toggle="list" data-bs-target="#@category.Name.Replace(" ", "-")" type="button" role="tab" aria-controls="@category.Name.Replace(" ", "-")" aria-selected="false">@category.Name</button>
            }
          </div>
        </div>
        <div class="tab-content col-sm-3" id="nav-tabContent">
          @foreach (Category category in Model.Categories)
          {
            <div class="tab-pane list-group fade" id="@category.Name.Replace(" ", "-")" role="tabpanel" aria-labelledby="@category.Name.Replace(" ", "-")-tab">
              @foreach (Product product in Model.Products.Where(p => p.CategoryId == category.CategoryId))
              {
                <a class="list-group-item d-flex justify-content-between align-items-center" style="width: available">
                  @product.Name
                  <form method="post" asp-page-handler="buy">
                    <input type="hidden" name="productId" value="@product.ProductId" />
                    <button class="AddCart btn badge bg-primary rounded-pill">+</button>
                  </form>
                </a>
              }
            </div>
          }
        </div>
        <div class="col-md-6">
          @* Order details *@
          <table class="table table-hover table-striped">
            <thead>
            <tr>
              <th scope="col">Product</th>
              <th scope="col">Aantal</th>
              <th scope="col"></th>
            </tr>
            </thead>
            <tbody>
            @if (Model != null && Model.Cart != null)
            {
              foreach (var orderItem in Model.Cart)
              {
                <tr>
                  <td>@orderItem.Product.Name</td>
                  <td>
                    <form method="post" asp-page-handler="minus">
                      <input type="hidden" name="productId" value="@orderItem.Product.ProductId"/>
                      <button class="btn badge bg-primary rounded-pill" style="float: left">-</button>
                    </form>
                    <span style="margin-left: 10px; margin-right: 10px; float: left">@orderItem.Quantity</span>
                    <form method="post" asp-page-handler="plus">
                      <input type="hidden" name="productId" value="@orderItem.Product.ProductId"/>
                      <button class="btn badge bg-primary rounded-pill" style="float: left">+</button>
                    </form>
                  </td>
                  @* remove product *@
                  <td>
                    <form method="post" asp-page-handler="remove">
                      <input type="hidden" name="productId" value="@orderItem.Product.ProductId"/>
                      <button class="btn badge bg-primary rounded-pill" style="float: left">X</button>
                    </form>
                  </td>
                </tr>
              }
            }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

@* Overzicht *@
<div class="tab-pane fade" id="overview" role="tabpanel" aria-labelledby="Overview-tab">
    <h2>Overzicht</h2>
    <table class="table table-hover table-striped">
      <thead>
      <tr>
        <th scope="col">Product</th>
        <th scope="col">Aantal</th>
        <th scope="col">Prijs</th>
        <th scope="col">Totaal</th>
      </tr>
      </thead>
      <tbody>
      @if (Model != null && Model.Cart != null)
      {
        foreach (var orderItem in Model.Cart)
        {
          <tr>
            <td>@orderItem.Product.Name</td>
            <td>
              <form method="post" asp-page-handler="minus">
                <input type="hidden" name="productId" value="@orderItem.Product.ProductId"/>
                <button class="btn badge bg-primary rounded-pill" style="float: left">-</button>
              </form>
              <span style="margin-left: 10px; margin-right: 10px; float: left">@orderItem.Quantity</span>
              <form method="post" asp-page-handler="plus">
                <input type="hidden" name="productId" value="@orderItem.Product.ProductId"/>
                <button class="btn badge bg-primary rounded-pill" style="float: left">+</button>
              </form>
            </td>
            <td>@($"{orderItem.Product.Price:n2}")</td>
            <td>@($"{orderItem.Product.Price * @orderItem.Quantity:n2}")</td>
          </tr>
        }
      }
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td>@($"{Model.Total:n2}")</td>
      </tr>
      </tbody>
    </table>
  </div>
  
@* Alles betalen*@
<div class="tab-pane fade" id="payAll" role="tabpanel" aria-labelledby="PayAll-tab">
    <h2>Rekening</h2>
  <table class="table table-hover table-striped">
    <thead>
    <tr>
      <th scope="col">Product</th>
      <th scope="col">Nog te betalen</th>
      <th scope="col">Prijs</th>
      <th scope="col">Totaal</th>
    </tr>
    </thead>
    <tbody>
    @if (Model != null && Model.Cart != null)
    {
      foreach (var orderItem in Model.Cart)
      {
        <tr>
          <td>@orderItem.Product?.Name</td>
          <td>@orderItem.Quantity van @orderItem.Quantity</td>
          <td>@($"{orderItem.Product.Price:n2}")</td>
          <td>@($"{orderItem.Product.Price * @orderItem.Quantity:n2}")</td>
        </tr>
      }
    }
    <tr>
      <td></td>
      <td></td>
      <td></td>
      <td>@($"{Model.Total:n2}")</td>
    </tr>
    </tbody>
  </table>
  @* Button on the bottom right side to pay *@
  <form method="post" asp-page-handler="pay">
    <button class="btn btn-primary" style="float: right">Betalen</button>
  </form>
</div>
  
@* Per persoon betalen*@
<div class="tab-pane fade" id="paySolo" role="tabpanel" aria-labelledby="contact-tab">
    <h2>Per persoon betalen</h2>
    <table class="table table-hover table-striped">
      <thead>
      <tr>
        <th scope="col">Product</th>
        <th scope="col">Nog te betalen</th>
        <th scope="col">Prijs</th>
        <th scope="col">Totaal</th>
      </tr>
      </thead>
      <tbody>
      @if (Model != null && Model.Cart != null)
      {
        foreach (var orderItem in Model.Cart)
        {
          <tr>
            <td>@orderItem.Product?.Name</td>
            <td>
              <form @*method="post" asp-page-handler="minus"*@>
                <input type="hidden" name="productId" value="@orderItem.Product.ProductId"/>
                <button id="PerPersoonMinus" class="btn badge bg-primary rounded-pill" style="float: left">-</button>
              </form>
              <span style="margin-left: 10px; margin-right: 10px; float: left">@orderItem.Quantity</span>
              <form @*method="post" asp-page-handler="plus"*@>
                <input type="hidden" name="productId" value="@orderItem.Product.ProductId"/>
                <button id="PerPersoonPlus" class="btn badge bg-primary rounded-pill" style="float: left">+</button>
              </form>
              <span style="margin-left: 10px; margin-right: 10px; float: left">van @orderItem.Quantity</span>
            </td>
            <td>@($"{orderItem.Product.Price:n2}")</td>
            <td>@($"{orderItem.Product.Price * @orderItem.Quantity:n2}")</td>
          </tr>
        }
      }
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td>@($"{Model.Total:n2}")</td>
      </tr>
      </tbody>
    </table>
  </div>
  
  
</div>

<script>
  $(document).ready(function () {
    // Per persoon betalen plus and minus buttons
    // $("#PerPersoonPlus").click(function () {
    //   var productId = $(this).parent().find("input[name='productId']").val();
    //   var quantity = $(this).parent().parent().find("span").text();
    //   var total = $(this).parent().parent().parent().find("td:eq(3)").text();
    //   var totalPrice = $(this).parent().parent().parent().find("td:eq(3)").text();
    //   var totalPrice = totalPrice.replace(",", ".");
    //   var totalPrice = parseFloat(totalPrice);
    //   var totalPrice = totalPrice / quantity;
    //   var totalPrice = totalPrice.toFixed(2);
    //   var totalPrice = totalPrice.replace(".", ",");
    //   var totalPrice = totalPrice.replace(",", ".");
    //   var totalPrice = parseFloat(totalPrice);
    //   var totalPrice = totalPrice * (quantity + 1);
    //   var totalPrice = totalPrice.toFixed(2);
    //   var totalPrice = totalPrice.replace(".", ",");
    //   var totalPrice = totalPrice.replace(",", ".");
    //   $.ajax({
    //     type: "POST",
    //     url: "/Order?handler=plus",
    //     data: {
    //       productId: productId,
    //       quantity: quantity,
    //       total: total,
    //       totalPrice: totalPrice
    //     },
    //     success: function (data) {
    //       $("#PerPersoonPlus").parent().parent().parent().find("td:eq(3)").text(data);
    //       $("#PerPersoonPlus").parent().parent().parent().find("td:eq(2)").text(totalPrice);
    //       $("#PerPersoonPlus").parent().parent().parent().find("td:eq(1)").text(quantity + 1);
    //     }
    //   });
    // });
  });
</script>
